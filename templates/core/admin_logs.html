{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Logs administrativos — Clube Pinhal Junior</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
    <link rel="stylesheet" href="{% static 'css/finance.css' %}" />
    {% include 'core/client_logger_head.html' %}
  </head>
  <body class="dashboard-page">
    <header class="dashboard-hero">
      <div>
        <p class="tag">Logs</p>
        <h1>Auditoria do sistema</h1>
        <p class="hero-text">
          Você está vendo as últimas entradas gravadas nos arquivos de log principais.
        </p>
        <div class="status-actions">
          <a class="ghost-btn" href="{% url 'dashboard' %}">Voltar ao painel</a>
        </div>
      </div>
    </header>

    <main class="dashboard-container">
      <header class="log-toolbar">
        <label>
          Escolha o arquivo
          <select id="log-file-select" class="log-file-select">
            {% for log in log_files %}
            <option value="log-{{ forloop.counter0 }}">{{ log.label }} ({{ log.path }})</option>
            {% endfor %}
          </select>
        </label>
        <p class="muted helper-text">
          Use o seletor acima para trocar entre `django.log.jsonl` e `client.log.jsonl`. Quando houver
          registros, eles aparecem em cada caixa; quando estiver vazio, exibimos o alerta reservado.
        </p>
      </header>
      {% for log in log_files %}
      <section
        class="panel log-panel"
        data-log-panel
        data-log-key="log-{{ forloop.counter0 }}"
      >
        <div class="panel-header">
          <div>
            <h2>{{ log.label }}</h2>
            <p class="muted">{{ log.path }}</p>
          </div>
          <div class="log-meta">
            <span class="tag" data-log-count>{{ log.lines|length }} linhas</span>
          </div>
        </div>
        <div class="log-controls">
          <label>
            Filtrar registros
            <input
              type="search"
              class="log-filter-input"
              placeholder="Digite request_id, nível ou texto"
              data-log-filter
            />
          </label>
          <button type="button" class="ghost-btn" data-log-clear>Limpar filtro</button>
        </div>
        {% if log.lines %}
        <div class="log-lines" data-log-lines>
          {% for line in log.lines %}
          <div class="log-line" data-log-line>
            <span class="log-line-prefix">{{ forloop.counter|stringformat:"02d" }}</span>
            <code>{{ line|escape }}</code>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p class="helper-text" data-log-empty>Nenhum registro foi encontrado para este arquivo.</p>
        {% endif %}
      </section>
      {% endfor %}
    </main>
    <script src="{% static 'js/admin-logs.js' %}"></script>
  </body>
</html>
